# 바이낸스 선물 자동 트레이딩 개발 계획서

## 1. 목표
- 바이낸스 선물 테스트넷을 통한 안전한 검증 후 라이브 전환을 지원.
- 백테스트/라이브 실행 경로를 일관된 전략 인터페이스로 통합.
- 리스크 관리, 로깅/감사로그, 알림 기반으로 운영 리스크를 최소화.

## 2. 범위 (초기 스코프)
- 단일 자산(비트코인 USDT 선물) 중심의 MVP.
- 백테스트 + 라이브 트레이딩(테스트넷/메인넷) 실행 도구 제공.
- 기본 리스크 관리(레버리지 한도, 손실 한도, 쿨다운, StopLoss) 포함.

> 참고: LLM 기반 “전략 생성/검증 파이프라인”은 추후 별도 모듈로 개발 예정이며, 현재 트리에는 포함하지 않습니다.

## 3. 주요 기능
- **데이터 공급**: 바이낸스 캔들/계좌/포지션 조회 인터페이스; 캐싱 및 재시도 포함.
- **백테스트**: 히스토리컬 캔들로 시뮬레이션, 수수료/슬리피지 반영, 리포트(PnL, MDD, 샤프, 승률) 제공.
- **라이브 트레이딩**: 테스트넷/라이브 스위치, 주문/취소/스탑/트레일링, 레버리지 설정, 일일 손실 한도.
- **버전 관리**: 전략 코드/메타/리포트를 버전으로 저장해 롤백 가능.

## 4. 아키텍처 개요
- **Frontend/CLI**: 전략 파일 선택, 실행 트리거, 로그/결과 조회.
- **Strategy Runtime**: `initialize(ctx)`, `on_bar(ctx, bar)` 등 정의; 공용 주문/데이터 API 주입.
- **Execution Modes**: 백테스트, 페이퍼, 라이브(테스트넷/메인넷) 공용 인터페이스.
- **Storage**: SQLite→Postgres 확장; 전략 버전, 트레이드 로그, 포지션 히스토리 저장.
- **Observability**: 구조화 로그, Slack/Email 알림, 메트릭(지연, 체결 성공률, PnL).

## 5. 기술 스택 제안
- Python 3.11+, Pydantic, httpx/aiohttp, Streamlit
- Tooling: uv, ruff, black, mypy

## 6. 개발 단계별 계획 (MVP 우선)
1) **프로젝트 스캐폴딩** (주차 1)
   - 전략 인터페이스 템플릿, 샌드박스 실행기 뼈대, 설정 관리(.env).
2) **데이터/연동 스모크** (주차 2)
   - 바이낸스 테스트넷 API 연동(계좌/시세/주문 스모크), 재시도/지연 측정.
   - MarketData/Order 인터페이스 안정화.
3) **백테스트 MVP** (주차 3)
   - 히스토리컬 캔들 로딩, 수수료/슬리피지 모델, 리포트(PnL/MDD/샤프) 생성.
   - 샘플 전략 회귀 스위트 구성.
4) **라이브 테스트넷** (주차 4)
   - 테스트넷 주문/취소/스탑/트레일링, 레버리지 설정, 일일 손실 한도/쿨다운.
   - 키 관리/암호화, 감사 로그.
5) **운영/하드닝** (주차 5~)
   - 알림/메트릭, 상태 복구, 전략 버전 롤백, 회귀 테스트 자동화(CI).

## 7. 테스트 전략
- 유닛: 전략 API, 포지션/주문 로직, 리스크 체크.
- 통합: 백테스트 루프, 페이퍼 체결, 테스트넷 주문/취소.
- 회귀: 대표 전략 세트로 짧은 백테스트 배치.

## 8. 리스크 및 대응
- **API 키/보안**: 키 암호화 저장, 최소 권한, 로테이션. 샌드박스로 파일/네트워크 제한.
- **체결/슬리피지**: 슬리피지/수수료 모델 반영, 주문 재시도/쿨다운.
- **운영 중단**: 워커 헬스체크, 재시작 시 상태 복구, 알림 채널 구성.

## 9. 향후 확장
- 멀티자산/멀티거래소, 심도 기반 슬리피지, 펀딩비 반영, 실시간 PnL 스트리밍.
- UI 확장(전략 비교, 리더보드, 리포트 자동 생성), A/B 전략 실험.
- 전략 저장소 분리(Blob/DB) 및 업로드 API, 캐시/버전 관리, 사용자별 전략 격리.

## 10. 추후 고려사항 (LLM 프록시 운영)
- 개발 단계는 Azure Container Apps 단일 프록시로 단순 운영.
- 상용 단계에서는 트래픽 변동/동시 사용자 수를 고려해 스케일링 전략 재검토.
- 다중 사용자 접근 통제를 위한 인증 방식(API Key vs Entra ID 로그인) 결정 필요.
- 단일 엔드포인트 보호를 위한 rate limit/쿼터 정책(API Management 등) 여부 검토.
