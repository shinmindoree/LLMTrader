ㅍ# LLM 기반 바이낸스 선물 자동 트레이딩 개발 계획서

## 1. 목표
- 자연어 전략 설명을 LLM으로 파이썬 전략 코드로 변환하고, 백테스트/페이퍼/라이브 트레이딩까지 이어지는 엔드투엔드 시스템 구축.
- 바이낸스 선물 테스트넷을 통한 안전한 검증 후 라이브 전환을 지원.
- 전략 코드의 디버깅/재현성을 높여 운영 리스크를 최소화.

## 2. 범위 (초기 스코프)
- 단일 자산(비트코인 USDT 선물) 중심의 MVP.
- LLM 코드 생성/검증 파이프라인, 백테스트, 페이퍼 트레이딩, 테스트넷 주문 연동까지 제공.
- 기본 리스크 관리(레버리지 한도, 손실 한도, 주문 재시도) 포함.

## 3. 주요 기능
- **전략 입력/코드 생성**: OpenAI API를 통한 전략 코드 생성, 템플릿/포맷팅/정적 분석(ruff/mypy) 후 샌드박스 스모크 실행.
- **코드 안전성**: 위험 import 차단, 파일/네트워크 접근 제한, 실행 타임아웃·메모리 제한.
- **데이터 공급**: 바이낸스 캔들/계좌/포지션 조회 인터페이스; 캐싱 및 재시도 포함.
- **백테스트**: 히스토리컬 캔들로 시뮬레이션, 수수료/슬리피지 반영, 리포트(PnL, MDD, 샤프, 승률) 제공.
- **페이퍼 트레이딩**: 실시간 시세 기반 가상 체결, 포지션/PNL 추적, 전략 로그/스냅샷 저장.
- **라이브 트레이딩**: 테스트넷/라이브 스위치, 주문/취소/스탑/트레일링, 레버리지 설정, 일일 손실 한도.
- **디버깅 지원**: 실행 로그, 입력/출력 스냅샷, 예외 스택, 재현 seed, 백테스트 대비 차이 diff.
- **버전 관리**: 전략 코드/메타/리포트를 버전으로 저장해 롤백 가능.

## 4. 아키텍처 개요
- **Frontend/CLI**: 전략 프롬프트 입력, 실행 트리거, 로그/결과 조회.
- **Backend API (FastAPI)**: LLM 호출, 전략 생성/검증, 실행 제어, 상태 제공.
- **Strategy Runtime**: `initialize(ctx)`, `on_bar(ctx, bar)` 등 정의; 공용 주문/데이터 API 주입.
- **Execution Modes**: 백테스트, 페이퍼, 라이브(테스트넷/메인넷) 공용 인터페이스.
- **Workers/Scheduler**: 시세 fetch, 전략 실행, 리스크 체크 주기 실행(Celery/APScheduler).
- **Storage**: SQLite→Postgres 확장; 전략 버전, 트레이드 로그, 포지션 히스토리 저장.
- **Observability**: 구조화 로그, Slack/Email 알림, 메트릭(지연, 체결 성공률, PnL).

## 5. 기술 스택 제안
- Python 3.11+, FastAPI, Pydantic, Uvicorn
- CCXT 또는 binance-futures-connector (선물)
- Task: Celery/APScheduler, Redis
- Tooling: poetry/uv, ruff, black, mypy, pytest

## 6. 개발 단계별 계획 (MVP 우선)
1) **프로젝트 스캐폴딩** (주차 1)
   - FastAPI 기본 서버, 헬스체크, 의존성/툴링 설정(ruff/black/mypy/pytest).
   - 전략 인터페이스 템플릿, 샌드박스 실행기 뼈대, 설정 관리(.env).
2) **LLM 연동** (주차 2)
   - 프롬프트 템플릿/역할 지정, 코드 생성 파이프라인, 정적 분석 + 포맷 자동화.
   - 샌드박스 스모크 실행 및 오류 리포트→재프롬프트 루프.
3) **데이터/연동 스모크** (주차 3)
   - 바이낸스 테스트넷 API 연동(계좌/시세/주문 스모크), 재시도/지연 측정.
   - MarketData/Order 인터페이스 안정화.
4) **백테스트 MVP** (주차 4)
   - 히스토리컬 캔들 로딩, 수수료/슬리피지 모델, 리포트(PnL/MDD/샤프) 생성.
   - 샘플 전략 회귀 스위트 구성.
5) **페이퍼 트레이딩** (주차 5)
   - 실시간 시세 소비, 가상 체결 엔진, 포지션/PNL 추적, 로그/스냅샷 저장.
6) **라이브 테스트넷** (주차 6)
   - 테스트넷 주문/취소/스탑/트레일링, 레버리지 설정, 일일 손실 한도/쿨다운.
   - 키 관리/암호화, 감사 로그.
7) **운영/하드닝** (주차 7~)
   - 알림/메트릭, 상태 복구, 전략 버전 롤백, 회귀 테스트 자동화(CI).

## 7. 테스트 전략
- 유닛: 전략 API, 포지션/주문 로직, 리스크 체크.
- 통합: 백테스트 루프, 페이퍼 체결, 테스트넷 주문/취소.
- 회귀: 대표 전략 세트로 짧은 백테스트 배치.
- 프로빙: LLM 생성 코드 샌드박스 스모크, 예외 재현 테스트.

## 8. 리스크 및 대응
- **API 키/보안**: 키 암호화 저장, 최소 권한, 로테이션. 샌드박스로 파일/네트워크 제한.
- **체결/슬리피지**: 슬리피지/수수료 모델 반영, 주문 재시도/쿨다운.
- **전략 품질**: 생성 코드 정적/동적 검증, 실패 로그로 재생성 루프, 회귀 테스트.
- **운영 중단**: 워커 헬스체크, 재시작 시 상태 복구, 알림 채널 구성.

## 9. 향후 확장
- 멀티자산/멀티거래소, 심도 기반 슬리피지, 펀딩비 반영, 실시간 PnL 스트리밍.
- UI 확장(전략 비교, 리더보드, 리포트 자동 생성), A/B 전략 실험.

